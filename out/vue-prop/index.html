<!DOCTYPE html><html lang="en" class="__className_577ed0"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/1f3fe8c6df3d47c1-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/4f05ba3a6752a328-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/82050c55ac1c8c11-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/52339771?v=4"/><link rel="stylesheet" href="/_next/static/css/48df2138df2e6856.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7198505728be4078.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/354c4f287ddbdae0.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/56ee663620872bf0.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-cc6f4bbd58f02c04.js"/><script src="/_next/static/chunks/2ef8672f-bc2daebf9fe2c5a3.js" async=""></script><script src="/_next/static/chunks/520-d0847c1effd7724e.js" async=""></script><script src="/_next/static/chunks/main-app-9923c9d1e6347b08.js" async=""></script><script src="/_next/static/chunks/252-c08bd2e6e79378f4.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/layout-c8e9a29bffafb4da.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-8d1acff9edb9c31b.js" async=""></script><meta name="next-size-adjust" content=""/><title>Vue 的响应性系统 — overreacted</title><meta name="description" content="写给每一个被 .value 搞烦过但又离不开它的你"/><link rel="icon" href="/icon.png?e0852c1e2c7f0e65" type="image/png" sizes="329x329"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]"><header class="mb-14 flex flex-row place-content-between"><a class="__className_096e99 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a><span class="relative top-[4px] italic">by<!-- --> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://swanine.com"><img alt="Swanine" src="https://avatars.githubusercontent.com/u/52339771?v=4" class="relative -top-1 mx-1 inline h-8 w-8 rounded-full"/></a></span></header><main><article><h1 class="__className_096e99 text-[40px] font-black leading-[44px] text-[--title]">Vue 的响应性系统</h1><p class="mt-2 text-[13px] text-gray-700 dark:text-gray-300">December 11, 2023</p><div class="markdown mt-10"><p>Vue 的响应性系统一直是它最核心也最有魅力的部分。从 Vue 2 的 <code>Object.defineProperty</code> 到 Vue 3 的 <code>Proxy</code>，再到 <code>Composition API</code> 中各种 <code>ref</code> / <code>reactive</code> / <code>watchEffect</code> 的使用方式，响应性这个东西，看起来就像魔法一样：你改了个值，页面跟着变；你访问了某个字段，Vue 悄悄记住了你；你什么都没声明，它居然就知道你想监听谁。</p>
<p>但当你深入了解后，会发现它不是魔法，更不是黑盒，而是基于 JavaScript 原生语言能力，精巧构建出来的一套“克制而不失强大”的机制。</p>
<p>这篇文章，我不想从 API 文档的角度复述 Vue 的响应性系统，而是想聊聊：它到底解决了什么问题？我们为什么需要它？我们又该如何更好地理解它、驾驭它？</p>
<hr/>
<h4>🧠 一切从“声明式”开始</h4>
<p>Vue 的设计初衷很简单：<strong>你只需要描述“你想要的界面”，其他的它来负责</strong>。</p>
<p>这是一种“声明式”的思维方式，不是命令浏览器一步步做什么，而是告诉 Vue：“页面长这样，只要我的数据变了，请帮我把页面也变一下”。</p>
<p>举个例子，如果你写：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="vue" data-theme="default"><code data-language="vue" data-theme="default" style="display:grid"><span data-line=""><span style="color:#C792EA">&lt;</span><span style="color:#FFA7C4">h1</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">class=</span><span style="color:#C792EA">&quot;</span><span style="color:#ECC48D">text-2xl</span><span style="color:#C792EA">&quot;</span><span style="color:#C792EA">&gt;</span><span style="color:#CED2D6">{{ user.name }}</span><span style="color:#C792EA">&lt;/</span><span style="color:#FFA7C4">h1</span><span style="color:#C792EA">&gt;</span></span></code></pre></div>
<p>你表达的是：“这地方要展示 <code>user.name</code>”，你<strong>没有</strong>说“当 <code>user.name</code> 改变时，请重新设置 innerText”，这些事情 Vue 自动帮你完成了。</p>
<p>这个自动化背后靠的是什么？就是它的响应性系统。</p>
<p>你每次访问 <code>user.name</code>，Vue 都在幕后偷偷地打了个点：“这个组件用了这个数据”，当你以后去改这个值时，Vue 就可以精准地“反查”所有依赖它的地方，然后刷新视图。
这种自动追踪依赖的设计，是 Vue 能做到“声明式更新”的根本支撑。</p>
<hr/>
<h3>⚙️ Proxy 是魔法的底层，但规则比你想的清晰</h3>
<p>Vue 3 把响应性的底层换成了 <code>Proxy</code>，这带来了很多好处：</p>
<ul>
<li>可以监听属性的添加和删除（<code>defineProperty</code> 做不到）</li>
<li>可以对数组、<code>Map</code>、<code>Set</code> 做响应式代理</li>
<li>性能更好，语义更清晰</li>
</ul>
<p>但它也带来了一些“让人头疼”的语法细节，比如 <code>.value</code>的出现。</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="js" data-theme="default"><code data-language="js" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">count</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">ref</span><span style="color:#C792EA">(</span><span style="color:#F78C6C">0</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#FFA7C4">console</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">log</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">count</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">value</span><span style="color:#C792EA">);</span><span style="color:#CED2D6"> </span><span style="color:#637777">// 必须 .value</span></span></code></pre></div>
<p>刚开始大家都在问：“为什么不能直接用 count？为啥要多这一层？”
我的理解是这样的：</p>
<ul>
<li><code>ref</code> 主要是为了处理<strong>原始类型的响应式</strong>（比如 number、string），而 JavaScript 的原始类型是没办法被代理的；</li>
<li>所以 Vue 把它包了一层对象 <code>{ value: xxx }</code>，从而实现对它的追踪；</li>
<li><code>.value</code> 就是你在“取值”的时候，明确告诉 Vue：“我要用这个响应式值的值了”，也让它知道你依赖了它。
这个 .value 看起来有点多余，但它是 Vue 的一种“语言限制下的让步”，也是一种很“克制”的设计。因为你如果直接返回值，Vue 就追踪不了是谁在用它。</li>
</ul>
<hr/>
<h3>🔁 Vue 不是监听数据，而是监听你“用了什么”</h3>
<p>Vue 的响应性系统最厉害的一点，不是“监听数据的变化”，而是“监听<strong>谁用到了这些数据</strong>”。
举个例子：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="js" data-theme="default"><code data-language="js" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">state</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">reactive</span><span style="color:#C792EA">({</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">name</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">swanine</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">age</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F78C6C">18</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#8EACE3">watchEffect</span><span style="color:#C792EA">(()</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">console</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">log</span><span style="color:#C792EA">(</span><span style="color:#C792EA">`你好，</span><span style="color:#7986E7">${</span><span style="color:#FFA7C4">state</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">name</span><span style="color:#7986E7">}</span><span style="color:#C792EA">`</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#C792EA">});</span></span></code></pre></div>
<p>这个副作用函数里只用到了 <code>state.name</code>，所以哪怕你改了 <code>state.age</code>，Vue 是不会重新执行 <code>watchEffect</code> 的。</p>
<p>这一点很多人第一次接触时会误解，以为只要这个对象改了，副作用函数就会重新运行。但 Vue 的依赖追踪是<strong>精确级别</strong>的，不仅节省了性能，也让你的逻辑更可控。</p>
<p>这是它响应性系统最精妙的地方：它<strong>不是监听对象</strong>，而是监听你“访问了哪些属性”。</p>
<hr/>
<h3>🧩 ref、reactive、computed、watch：各有分工</h3>
<p>Vue 3 中响应性相关的 API 很多，初学者经常会迷糊：什么时候用 <code>ref</code>，什么时候用 <code>reactive</code>，<code>computed</code> 和 <code>watch</code> 又有什么区别？
下面是我的一点总结：</p>
<table class="grid w-full grid-cols-[auto_auto] border-b border-gray-900/10 dark:border-white/10"><thead class="col-span-3 grid grid-cols-subgrid"><tr class="col-span-3 grid grid-cols-subgrid"><th class="px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white">API</th><th class="px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white">适用场景</th><th class="px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white">特点</th></tr></thead><tbody class="col-span-3 grid grid-cols-subgrid border-t border-gray-900/10 dark:border-white/10"><tr class="col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5"><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium "><code>ref</code></td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">基础值（number、string、boolean）或你想用 <code>.value</code> 明确引用的情况</td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">有 <code>.value</code>，可以包对象</td></tr><tr class="col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5"><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium "><code>reactive</code></td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">对象或数组整体作为响应式使用时</td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">不需要 <code>.value</code>，但不能包基础类型</td></tr><tr class="col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5"><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium "><code>computed</code></td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">需要根据已有状态<b>派生出新状态</b>时</td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">自动缓存，只有依赖变化才重新计算</td></tr><tr class="col-span-3 grid grid-cols-subgrid not-last:border-b not-last:border-gray-950/5 dark:not-last:border-white/5"><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium "><code>watch</code></td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">明确观察某个值的变化，并在变化时执行副作用</td><td class="px-2 py-2 align-top font-mono text-xs/6 font-medium ">比 <code>watchEffect</code> 更细粒度，更适合处理异步请求等副作用</td></tr></tbody></table>
<p>这套 API 听起来有点复杂，但你只要记住：<strong>ref 是数据源，computed 是衍生数据，watch 是监听变化后执行事情</strong>。</p>
<p>一旦理解了这三个角色的分工，写 Vue 的状态管理会变得非常轻松。</p>
<hr/>
<h3>🧨 响应性陷阱：你以为响应了，其实没反应</h3>
<p>Vue 的响应性也不是没有坑，下面列几个我踩过的常见误区：</p>
<p><strong>1. 解构后失去响应性</strong></p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="js" data-theme="default"><code data-language="js" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">state</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">reactive</span><span style="color:#C792EA">({</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">count</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F78C6C">1</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">});</span></span>
<span data-line=""><span style="color:#FFA7C4">const { </span><span style="color:#CED2D6">count</span><span style="color:#FFA7C4"> } </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">state</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#8EACE3">watchEffect</span><span style="color:#C792EA">(()</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">console</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">log</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">count</span><span style="color:#C792EA">);</span><span style="color:#CED2D6"> </span><span style="color:#637777">// ❌ 不会响应更新</span></span>
<span data-line=""><span style="color:#C792EA">});</span></span></code></pre></div>
<p>这是因为 <code>count</code> 只是普通变量，不再是响应式引用。解决方式有两个：</p>
<ul>
<li>不解构，直接用 <code>state.count</code></li>
<li>或者用 <code>toRefs(state)</code> 转换</li>
</ul>
<p><strong>2. reactive 包原始类型失效</strong></p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="js" data-theme="default"><code data-language="js" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">const </span><span style="color:#CED2D6">value</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#FFA7C4"> </span><span style="color:#8EACE3">reactive</span><span style="color:#C792EA">(</span><span style="color:#F78C6C">1</span><span style="color:#C792EA">);</span><span style="color:#CED2D6"> </span><span style="color:#637777">// ❌ 不生效</span></span></code></pre></div>
<p>你得用 <code>ref(1)</code> 才行。</p>
<p><strong>3. 非响应式数据写进响应式对象</strong>
如果你往响应式对象里塞一个非响应式的 class 实例，Vue 是不会追踪它内部状态的，因为它没办法代理它。</p>
<hr/>
<h3>🌱 响应性是一种“哲学”，而不是一个工具</h3>
<p>用 Vue 时间久了之后，我越来越觉得，响应性并不是一个“功能”，而是一种思维方式：</p>
<ul>
<li>少些 DOM 操作，多些状态描述</li>
<li>少些命令式流程控制，多些状态流动</li>
<li>少些“先改值再更新视图”，多些“值一改，视图自然跟着变”</li>
</ul>
<p>Vue 的响应性系统，其实是在鼓励你信任<strong>数据的力量</strong>，而不是把注意力放在“更新页面”这种重复性劳动上。</p>
<p>这也解释了为什么 Vue 能让初学者觉得“好上手”，又让老手觉得“写得顺手”——它并没有强迫你用很重的概念，而是用一种非常自然的方式，把“状态”和“界面”连接起来了。</p>
<hr/>
<h3>🎯 最后想说的</h3>
<p>Vue 的响应性系统，是一个<strong>让你更关注业务逻辑、少关注框架细节</strong>的好设计。</p>
<p>它就像一个永远在背后默默记录的帮手，从不插手你要干什么，但你每次写代码的时候，它已经帮你安排好了一切依赖。</p>
<p>我们程序员最怕的，其实是“失控”：不知道哪段逻辑影响了什么，不知道哪段更新会触发什么。但 Vue 的响应性，是可预测的、有限度的、结构清晰的。这种设计本身，就是一种“克制的自由”。</p>
<p>你以为它是魔法，其实它只是太贴心了。</p><hr/><p><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://bsky.app/search?q=https%3A%2F%2Foverreacted.io%2Fvue-prop%2F">Discuss on Bluesky</a>  ·  <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/swanine">Edit on GitHub</a></p></div></article><!--$--><!--/$--><!--$--><!--/$--><footer class="mt-12"><a class="__className_096e99 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">overreacted</span></a></footer></main><script src="/_next/static/chunks/webpack-cc6f4bbd58f02c04.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9019,[\"252\",\"static/chunks/252-c08bd2e6e79378f4.js\",\"25\",\"static/chunks/app/%5Bslug%5D/layout-c8e9a29bffafb4da.js\"],\"default\"]\n3:I[4172,[\"252\",\"static/chunks/252-c08bd2e6e79378f4.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-8d1acff9edb9c31b.js\"],\"default\"]\n4:I[505,[],\"\"]\n5:I[6221,[],\"\"]\n7:I[1327,[],\"MetadataBoundary\"]\n9:I[1327,[],\"OutletBoundary\"]\nc:I[9989,[],\"AsyncMetadataOutlet\"]\ne:I[1327,[],\"ViewportBoundary\"]\n10:I[7992,[],\"\"]\n:HL[\"/_next/static/media/1f3fe8c6df3d47c1-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/4f05ba3a6752a328-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/82050c55ac1c8c11-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/48df2138df2e6856.css\",\"style\"]\n:HL[\"/_next/static/css/7198505728be4078.css\",\"style\"]\n:HL[\"/_next/static/css/354c4f287ddbdae0.css\",\"style\"]\n:HL[\"/_next/static/css/56ee663620872bf0.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"QpSHpR0C-SmZGHI7UkrYg\",\"p\":\"\",\"c\":[\"\",\"vue-prop\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"vue-prop\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/48df2138df2e6856.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7198505728be4078.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/354c4f287ddbdae0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__className_577ed0\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-14 flex flex-row place-content-between\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"span\",null,{\"className\":\"relative top-[4px] italic\",\"children\":[\"by\",\" \",[\"$\",\"$L3\",null,{\"href\":\"https://swanine.com\",\"target\":\"_blank\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Swanine\",\"src\":\"https://avatars.githubusercontent.com/u/52339771?v=4\",\"className\":\"relative -top-1 mx-1 inline h-8 w-8 rounded-full\"}]}]]}]]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"article\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_096e99 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Not found\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[[\"$\",\"p\",null,{\"children\":\"This page doesn't exist (yet?)\"}],[\"$\",\"p\",null,{\"children\":[\"I recently rewrote the site so maybe something broke. Please\",\" \",[\"$\",\"$L3\",null,{\"href\":\"https://github.com/swanine\",\"children\":\"complain here.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If you're looking for translated posts, they're not on the site anymore but you can find\",\" \",[\"$\",\"$L3\",null,{\"href\":\"https://github.com/swanine\",\"children\":\"an archive of them here.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Hope you'll find what you're looking for.\"}]]}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/56ee663620872bf0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]]}],{\"children\":[[\"slug\",\"vue-prop\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"mt-12\",\"children\":[\"$\",\"$L2\",null,{}]}]]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[\"$\",\"$L7\",null,{\"children\":\"$L8\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/56ee663620872bf0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L9\",null,{\"children\":[\"$La\",\"$Lb\",[\"$\",\"$Lc\",null,{\"promise\":\"$@d\"}]]}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"3M-BFcZ0ySEuYahhFVzqG\",{\"children\":[[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"11:\"$Sreact.suspense\"\n12:I[9989,[],\"AsyncMetadata\"]\n8:[\"$\",\"$11\",null,{\"fallback\":null,\"children\":[\"$\",\"$L12\",null,{\"promise\":\"$@13\"}]}]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:null\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"article\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_096e99 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Vue 的响应性系统\"}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-[13px] text-gray-700 dark:text-gray-300\",\"children\":\"December 11, 2023\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[\"$L14\",[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"$L3\",null,{\"href\":\"https://bsky.app/search?q=https%3A%2F%2Foverreacted.io%2Fvue-prop%2F\",\"children\":\"Discuss on Bluesky\"}],\"  ·  \",[\"$\",\"$L3\",null,{\"href\":\"https://github.com/swanine\",\"children\":\"Edit on GitHub\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"p\",null,{\"children\":[\"Vue 的响应性系统一直是它最核心也最有魅力的部分。从 Vue 2 的 \",[\"$\",\"code\",null,{\"children\":\"Object.defineProperty\"}],\" 到 Vue 3 的 \",[\"$\",\"code\",null,{\"children\":\"Proxy\"}],\"，再到 \",[\"$\",\"code\",null,{\"children\":\"Composition API\"}],\" 中各种 \",[\"$\",\"code\",null,{\"children\":\"ref\"}],\" / \",[\"$\",\"code\",null,{\"children\":\"reactive\"}],\" / \",[\"$\",\"code\",null,{\"children\":\"watchEffect\"}],\" 的使用方式，响应性这个东西，看起来就像魔法一样：你改了个值，页面跟着变；你访问了某个字段，Vue 悄悄记住了你；你什么都没声明，它居然就知道你想监听谁。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"但当你深入了解后，会发现它不是魔法，更不是黑盒，而是基于 JavaScript 原生语言能力，精巧构建出来的一套“克制而不失强大”的机制。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这篇文章，我不想从 API 文档的角度复述 Vue 的响应性系统，而是想聊聊：它到底解决了什么问题？我们为什么需要它？我们又该如何更好地理解它、驾驭它？\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"🧠 一切从“声明式”开始\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 的设计初衷很简单：\",[\"$\",\"strong\",null,{\"children\":\"你只需要描述“你想要的界面”，其他的它来负责\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这是一种“声明式”的思维方式，不是命令浏览器一步步做什么，而是告诉 Vue：“页面长这样，只要我的数据变了，请帮我把页面也变一下”。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"举个例子，如果你写：\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"vue\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"vue\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"class=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"text-2xl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"{{ user.name }}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"你表达的是：“这地方要展示 \",[\"$\",\"code\",null,{\"children\":\"user.name\"}],\"”，你\",[\"$\",\"strong\",null,{\"children\":\"没有\"}],\"说“当 \",[\"$\",\"code\",null,{\"children\":\"user.name\"}],\" 改变时，请重新设置 innerText”，这些事情 Vue 自动帮你完成了。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这个自动化背后靠的是什么？就是它的响应性系统。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"你每次访问 \",[\"$\",\"code\",null,{\"children\":\"user.name\"}],\"，Vue 都在幕后偷偷地打了个点：“这个组件用了这个数据”，当你以后去改这个值时，Vue 就可以精准地“反查”所有依赖它的地方，然后刷新视图。\\n这种自动追踪依赖的设计，是 Vue 能做到“声明式更新”的根本支撑。\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"⚙️ Proxy 是魔法的底层，但规则比你想的清晰\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 3 把响应性的底层换成了 \",[\"$\",\"code\",null,{\"children\":\"Proxy\"}],\"，这带来了很多好处：\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"可以监听属性的添加和删除（\",[\"$\",\"code\",null,{\"children\":\"defineProperty\"}],\" 做不到）\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"可以对数组、\",[\"$\",\"code\",null,{\"children\":\"Map\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"Set\"}],\" 做响应式代理\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"性能更好，语义更清晰\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"但它也带来了一些“让人头疼”的语法细节，比如 \",[\"$\",\"code\",null,{\"children\":\".value\"}],\"的出现。\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"js\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"ref\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"console\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 必须 .value\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"刚开始大家都在问：“为什么不能直接用 count？为啥要多这一层？”\\n我的理解是这样的：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ref\"}],\" 主要是为了处理\",[\"$\",\"strong\",null,{\"children\":\"原始类型的响应式\"}],\"（比如 number、string），而 JavaScript 的原始类型是没办法被代理的；\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"所以 Vue 把它包了一层对象 \",[\"$\",\"code\",null,{\"children\":\"{ value: xxx }\"}],\"，从而实现对它的追踪；\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".value\"}],\" 就是你在“取值”的时候，明确告诉 Vue：“我要用这个响应式值的值了”，也让它知道你依赖了它。\\n这个 .value 看起来有点多余，但它是 Vue 的一种“语言限制下的让步”，也是一种很“克制”的设计。因为你如果直接返回值，Vue 就追踪不了是谁在用它。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🔁 Vue 不是监听数据，而是监听你“用了什么”\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 的响应性系统最厉害的一点，不是“监听数据的变化”，而是“监听\",[\"$\",\"strong\",null,{\"children\":\"谁用到了这些数据\"}],\"”。\\n举个例子：\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"js\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"state\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"reactive\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"({\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"swanine\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"age\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"18\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"watchEffect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"console\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"`你好，\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#7986E7\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"state\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#7986E7\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"`\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这个副作用函数里只用到了 \",[\"$\",\"code\",null,{\"children\":\"state.name\"}],\"，所以哪怕你改了 \",[\"$\",\"code\",null,{\"children\":\"state.age\"}],\"，Vue 是不会重新执行 \",[\"$\",\"code\",null,{\"children\":\"watchEffect\"}],\" 的。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这一点很多人第一次接触时会误解，以为只要这个对象改了，副作用函数就会重新运行。但 Vue 的依赖追踪是\",[\"$\",\"strong\",null,{\"children\":\"精确级别\"}],\"的，不仅节省了性能，也让你的逻辑更可控。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这是它响应性系统最精妙的地方：它\",[\"$\",\"strong\",null,{\"children\":\"不是监听对象\"}],\"，而是监听你“访问了哪些属性”。\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🧩 ref、reactive、computed、watch：各有分工\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 3 中响应性相关的 API 很多，初学者经常会迷糊：什么时候用 \",[\"$\",\"code\",null,{\"children\":\"ref\"}],\"，什么时候用 \",[\"$\",\"code\",null,{\"children\":\"reactive\"}],\"，\",[\"$\",\"code\",null,{\"children\":\"computed\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"watch\"}],\" 又有什么区别？\\n下面是我的一点总结：\"]}],\"\\n\",[\"$\",\"table\",null,{\"class\":\"grid w-full grid-cols-[auto_auto] border-b border-gray-900/10 dark:border-white/10\",\"children\":[[\"$\",\"thead\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid\",\"children\":[\"$\",\"tr\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid\",\"children\":[[\"$\",\"th\",null,{\"class\":\"px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white\",\"children\":\"API\"}],[\"$\",\"th\",null,{\"class\":\"px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white\",\"children\":\"适用场景\"}],[\"$\",\"th\",null,{\"class\":\"px-2 py-2.5 text-left text-sm/7 font-semibold text-gray-950 dark:text-white\",\"children\":\"特点\"}]]}]}],[\"$\",\"tbody\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid border-t border-gray-900/10 dark:border-white/10\",\"children\":[[\"$\",\"tr\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5\",\"children\":[[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"$\",\"code\",null,{\"children\":\"ref\"}]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"基础值（number、string、boolean）或你想用 \",[\"$\",\"code\",null,{\"children\":\".value\"}],\" 明确引用的情况\"]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"有 \",[\"$\",\"code\",null,{\"children\":\".value\"}],\"，可以包对象\"]}]]}],[\"$\",\"tr\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5\",\"children\":[[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"$\",\"code\",null,{\"children\":\"reactive\"}]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":\"对象或数组整体作为响应式使用时\"}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"不需要 \",[\"$\",\"code\",null,{\"children\":\".value\"}],\"，但不能包基础类型\"]}]]}],[\"$\",\"tr\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid border-b border-gray-950/5 dark:border-white/5\",\"children\":[[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"$\",\"code\",null,{\"children\":\"computed\"}]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"需要根据已有状态\",[\"$\",\"b\",null,{\"children\":\"派生出新状态\"}],\"时\"]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":\"自动缓存，只有依赖变化才重新计算\"}]]}],[\"$\",\"tr\",null,{\"class\":\"col-span-3 grid grid-cols-subgrid not-last:border-b not-last:border-gray-950/5 dark:not-last:border-white/5\",\"children\":[[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"$\",\"code\",null,{\"children\":\"watch\"}]}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":\"明确观察某个值的变化，并在变化时执行副作用\"}],[\"$\",\"td\",null,{\"class\":\"px-2 py-2 align-top font-mono text-xs/6 font-medium \",\"children\":[\"比 \",[\"$\",\"code\",null,{\"children\":\"watchEffect\"}],\" 更细粒度，更适合处理异步请求等副作用\"]}]]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这套 API 听起来有点复杂，但你只要记住：\",[\"$\",\"strong\",null,{\"children\":\"ref 是数据源，computed 是衍生数据，watch 是监听变化后执行事情\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"一旦理解了这三个角色的分工，写 Vue 的状态管理会变得非常轻松。\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🧨 响应性陷阱：你以为响应了，其实没反应\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Vue 的响应性也不是没有坑，下面列几个我踩过的常见误区：\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"1. 解构后失去响应性\"}]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"js\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"state\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"reactive\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"({\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"state\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"watchEffect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"console\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// ❌ 不会响应更新\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这是因为 \",[\"$\",\"code\",null,{\"children\":\"count\"}],\" 只是普通变量，不再是响应式引用。解决方式有两个：\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"不解构，直接用 \",[\"$\",\"code\",null,{\"children\":\"state.count\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"或者用 \",[\"$\",\"code\",null,{\"children\":\"toRefs(state)\"}],\" 转换\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"2. reactive 包原始类型失效\"}]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"js\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"const \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"reactive\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// ❌ 不生效\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"你得用 \",[\"$\",\"code\",null,{\"children\":\"ref(1)\"}],\" 才行。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"3. 非响应式数据写进响应式对象\"}],\"\\n如果你往响应式对象里塞一个非响应式的 class 实例，Vue 是不会追踪它内部状态的，因为它没办法代理它。\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🌱 响应性是一种“哲学”，而不是一个工具\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"用 Vue 时间久了之后，我越来越觉得，响应性并不是一个“功能”，而是一种思维方式：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"少些 DOM 操作，多些状态描述\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"少些命令式流程控制，多些状态流动\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"少些“先改值再更新视图”，多些“值一改，视图自然跟着变”\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 的响应性系统，其实是在鼓励你信任\",[\"$\",\"strong\",null,{\"children\":\"数据的力量\"}],\"，而不是把注意力放在“更新页面”这种重复性劳动上。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这也解释了为什么 Vue 能让初学者觉得“好上手”，又让老手觉得“写得顺手”——它并没有强迫你用很重的概念，而是用一种非常自然的方式，把“状态”和“界面”连接起来了。\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"🎯 最后想说的\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Vue 的响应性系统，是一个\",[\"$\",\"strong\",null,{\"children\":\"让你更关注业务逻辑、少关注框架细节\"}],\"的好设计。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"它就像一个永远在背后默默记录的帮手，从不插手你要干什么，但你每次写代码的时候，它已经帮你安排好了一切依赖。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我们程序员最怕的，其实是“失控”：不知道哪段逻辑影响了什么，不知道哪段更新会触发什么。但 Vue 的响应性，是可预测的、有限度的、结构清晰的。这种设计本身，就是一种“克制的自由”。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"你以为它是魔法，其实它只是太贴心了。\"}]]\n"])</script><script>self.__next_f.push([1,"13:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Vue 的响应性系统 — overreacted\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"写给每一个被 .value 搞烦过但又离不开它的你\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/icon.png?e0852c1e2c7f0e65\",\"type\":\"image/png\",\"sizes\":\"329x329\"}]],\"error\":null,\"digest\":\"$undefined\"}\nd:{\"metadata\":\"$13:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>